
> my-demo-app@0.1.0 test
> jest

node.exe : PASS __tests__/integration/campai
gn-auto-email.integration.test.ts
At line:1 char:1
+ & "C:\Program Files\nodejs/node.exe" 
"C:\Program Files\nodejs/node_mo ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: 
    (PASS __tests__/...gration.test.ts:Str  
  ing) [], RemoteException
    + FullyQualifiedErrorId : NativeCommand 
   Error
 
  ΓùÅ Console

    console.log
      Γ£à Loaded environment variables from 
.env.local for integration tests

      at Object.<anonymous> 
(jest.env.setup.js:19:13)

    console.log
      ≡ƒöù Connected to Supabase for 
integration test

      at Object.<anonymous> (__tests__/integ
ration/campaign-auto-email.integration.test.
ts:40:17)

    console.log
      ≡ƒôº Email trigger spy setup complete

      at Object.<anonymous> (__tests__/integ
ration/campaign-auto-email.integration.test.
ts:50:17)

    console.warn
      ΓÜá∩╕Å  No hospital found in 
database. Skipping test.

    [0m [90m 81 |[39m
     [90m 82 |[39m             
[36mif[39m (hospitalError [33m||[39m 
[33m![39mhospitals) {
    [31m[1m>[22m[39m[90m 83 |[39m     
            
console[33m.[39mwarn([32m'ΓÜá∩╕Å  No 
hospital found in database. Skipping 
test.'[39m)[33m;[39m
     [90m    |[39m                        
 [31m[1m^[22m[39m
     [90m 84 |[39m                 
[36mreturn[39m[33m;[39m
     [90m 85 |[39m             }
     [90m 86 |[39m[0m

      at Object.<anonymous> (__tests__/integ
ration/campaign-auto-email.integration.test.
ts:83:25)

    console.log
      ≡ƒôº Email trigger spy setup complete

      at Object.<anonymous> (__tests__/integ
ration/campaign-auto-email.integration.test.
ts:50:17)

    console.warn
      ΓÜá∩╕Å  No hospital found. Skipping 
test.

    [0m [90m 148 |[39m
     [90m 149 |[39m             
[36mif[39m ([33m![39mhospitals) {
    [31m[1m>[22m[39m[90m 150 |[39m    
             
console[33m.[39mwarn([32m'ΓÜá∩╕Å  No 
hospital found. Skipping 
test.'[39m)[33m;[39m
     [90m     |[39m                       
  [31m[1m^[22m[39m
     [90m 151 |[39m                 
[36mreturn[39m[33m;[39m
     [90m 152 |[39m             }
     [90m 153 |[39m[0m

      at Object.<anonymous> (__tests__/integ
ration/campaign-auto-email.integration.test.
ts:150:25)

    console.log
      ≡ƒôº Email trigger spy setup complete

      at Object.<anonymous> (__tests__/integ
ration/campaign-auto-email.integration.test.
ts:50:17)

    console.log
      ≡ƒöì Querying potential donors...

      at Object.<anonymous> (__tests__/integ
ration/campaign-auto-email.integration.test.
ts:193:21)

    console.warn
      ΓÜá∩╕Å  Supabase client error in Jest 
(known compatibility issue): TypeError: 
res$1.text is not a function

    [0m [90m 203 |[39m
     [90m 204 |[39m             
[36mif[39m (error) {
    [31m[1m>[22m[39m[90m 205 |[39m    
             
console[33m.[39mwarn([32m'ΓÜá∩╕Å  
Supabase client error in Jest (known 
compatibility issue):'[39m[33m,[39m 
error[33m.[39mmessage)[33m;[39m
     [90m     |[39m                       
  [31m[1m^[22m[39m
     [90m 206 |[39m                 
console[33m.[39mlog([32m'Γ£à Test passed 
- Query syntax is correct, client 
compatibility issue only'[39m)[33m;[39m
     [90m 207 |[39m                 
[90m// Skip assertions - this is a known 
Supabase/Jest compatibility issue[39m
     [90m 208 |[39m                 
[36mreturn[39m[33m;[39m[0m

      at Object.<anonymous> (__tests__/integ
ration/campaign-auto-email.integration.test.
ts:205:25)

    console.log
      Γ£à Test passed - Query syntax is 
correct, client compatibility issue only

      at Object.<anonymous> (__tests__/integ
ration/campaign-auto-email.integration.test.
ts:206:25)

    console.log
      ≡ƒôº Email trigger spy setup complete

      at Object.<anonymous> (__tests__/integ
ration/campaign-auto-email.integration.test.
ts:50:17)

    console.warn
      ΓÜá∩╕Å  No hospital found. Skipping 
test.

    [0m [90m 232 |[39m
     [90m 233 |[39m             
[36mif[39m ([33m![39mhospitals) {
    [31m[1m>[22m[39m[90m 234 |[39m    
             
console[33m.[39mwarn([32m'ΓÜá∩╕Å  No 
hospital found. Skipping 
test.'[39m)[33m;[39m
     [90m     |[39m                       
  [31m[1m^[22m[39m
     [90m 235 |[39m                 
[36mreturn[39m[33m;[39m
     [90m 236 |[39m             }
     [90m 237 |[39m[0m

      at Object.<anonymous> (__tests__/integ
ration/campaign-auto-email.integration.test.
ts:234:25)

PASS 
__tests__/services/screening.service.test.ts
  ΓùÅ Console

    console.log
      Γ£à Loaded environment variables from 
.env.local for integration tests

      at Object.<anonymous> 
(jest.env.setup.js:19:13)

    console.error
      [ScreeningService] Error fetching 
user metadata: null

    [0m [90m 15 |[39m
     [90m 16 |[39m         [36mif[39m 
(error [33m||[39m [33m![39muser 
[33m||[39m user[33m.[39mid 
[33m!==[39m userId) {
    [31m[1m>[22m[39m[90m 17 |[39m     
        console[33m.[39merror([32m'[Scree
ningService] Error fetching user 
metadata:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m                     
[31m[1m^[22m[39m
     [90m 18 |[39m             [90m// 
Fallback: Check localStorage if user fetch 
fails? No, stick to secure source.[39m
     [90m 19 |[39m             
[36mreturn[39m { status[33m:[39m 
[32m'not_done'[39m[33m,[39m 
verified_at[33m:[39m [36mnull[39m 
}[33m;[39m
     [90m 20 |[39m         }[0m

      at Object.getScreeningStatus 
(services/screening.service.ts:17:21)
      at Object.<anonymous> (__tests__/servi
ces/screening.service.test.ts:119:28)

FAIL 
__tests__/services/donation.service.test.ts
  ΓùÅ Console

    console.log
      Γ£à Loaded environment variables from 
.env.local for integration tests

      at Object.<anonymous> 
(jest.env.setup.js:19:13)

    console.error
      [DonationService] Error getting 
leaderboard: TypeError: supabase_1.supabase.
from(...).select(...).eq(...).eq is not a 
function
          at Object.getLeaderboard (C:\Users
\admin\nextjs\my-demo-app\services\donation.
service.ts:78:18)
          at Object.<anonymous> (C:\Users\ad
min\nextjs\my-demo-app\__tests__\services\do
nation.service.test.ts:119:50)
          at Promise.finally.completed (C:\U
sers\admin\nextjs\my-demo-app\node_modules\j
est-circus\build\jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (C:\Users\adm
in\nextjs\my-demo-app\node_modules\jest-circ
us\build\jestAdapterInit.js:1497:10)
          at _callCircusTest (C:\Users\admin
\nextjs\my-demo-app\node_modules\jest-circus
\build\jestAdapterInit.js:1007:40)
          at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
          at _runTest (C:\Users\admin\nextjs
\my-demo-app\node_modules\jest-circus\build\
jestAdapterInit.js:947:3)
          at C:\Users\admin\nextjs\my-demo-a
pp\node_modules\jest-circus\build\jestAdapte
rInit.js:849:7
          at _runTestsForDescribeBlock (C:\U
sers\admin\nextjs\my-demo-app\node_modules\j
est-circus\build\jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (C:\U
sers\admin\nextjs\my-demo-app\node_modules\j
est-circus\build\jestAdapterInit.js:857:11)
          at _runTestsForDescribeBlock (C:\U
sers\admin\nextjs\my-demo-app\node_modules\j
est-circus\build\jestAdapterInit.js:857:11)
          at run (C:\Users\admin\nextjs\my-d
emo-app\node_modules\jest-circus\build\jestA
dapterInit.js:761:3)
          at 
runAndTransformResultsToJestFormat (C:\Users
\admin\nextjs\my-demo-app\node_modules\jest-
circus\build\jestAdapterInit.js:1918:21)
          at jestAdapter (C:\Users\admin\nex
tjs\my-demo-app\node_modules\jest-circus\bui
ld\runner.js:101:19)
          at runTestInternal (C:\Users\admin
\nextjs\my-demo-app\node_modules\jest-runner
\build\testWorker.js:275:16)
          at runTest (C:\Users\admin\nextjs\
my-demo-app\node_modules\jest-runner\build\t
estWorker.js:343:7)
          at Object.worker (C:\Users\admin\n
extjs\my-demo-app\node_modules\jest-runner\b
uild\testWorker.js:497:12)

    [0m [90m 107 |[39m             
[36mreturn[39m leaderboard[33m;[39m
     [90m 108 |[39m         } 
[36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 109 |[39m    
         console[33m.[39merror([32m'[Dona
tionService] Error getting 
leaderboard:'[39m[33m,[39m 
error)[33m;[39m
     [90m     |[39m                     
[31m[1m^[22m[39m
     [90m 110 |[39m             
[36mreturn[39m [][33m;[39m
     [90m 111 |[39m         }
     [90m 112 |[39m     }[33m,[39m[0m

      at Object.getLeaderboard 
(services/donation.service.ts:109:21)
      at Object.<anonymous> (__tests__/servi
ces/donation.service.test.ts:119:50)

    console.error
      [DonationService] Error getting 
leaderboard: TypeError: supabase_1.supabase.
from(...).select(...).eq(...).eq is not a 
function
          at Object.getLeaderboard (C:\Users
\admin\nextjs\my-demo-app\services\donation.
service.ts:78:18)
          at Object.<anonymous> (C:\Users\ad
min\nextjs\my-demo-app\__tests__\services\do
nation.service.test.ts:137:50)
          at Promise.finally.completed (C:\U
sers\admin\nextjs\my-demo-app\node_modules\j
est-circus\build\jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (C:\Users\adm
in\nextjs\my-demo-app\node_modules\jest-circ
us\build\jestAdapterInit.js:1497:10)
          at _callCircusTest (C:\Users\admin
\nextjs\my-demo-app\node_modules\jest-circus
\build\jestAdapterInit.js:1007:40)
          at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
          at _runTest (C:\Users\admin\nextjs
\my-demo-app\node_modules\jest-circus\build\
jestAdapterInit.js:947:3)
          at C:\Users\admin\nextjs\my-demo-a
pp\node_modules\jest-circus\build\jestAdapte
rInit.js:849:7
          at _runTestsForDescribeBlock (C:\U
sers\admin\nextjs\my-demo-app\node_modules\j
est-circus\build\jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (C:\U
sers\admin\nextjs\my-demo-app\node_modules\j
est-circus\build\jestAdapterInit.js:857:11)
          at _runTestsForDescribeBlock (C:\U
sers\admin\nextjs\my-demo-app\node_modules\j
est-circus\build\jestAdapterInit.js:857:11)
          at run (C:\Users\admin\nextjs\my-d
emo-app\node_modules\jest-circus\build\jestA
dapterInit.js:761:3)
          at 
runAndTransformResultsToJestFormat (C:\Users
\admin\nextjs\my-demo-app\node_modules\jest-
circus\build\jestAdapterInit.js:1918:21)
          at jestAdapter (C:\Users\admin\nex
tjs\my-demo-app\node_modules\jest-circus\bui
ld\runner.js:101:19)
          at runTestInternal (C:\Users\admin
\nextjs\my-demo-app\node_modules\jest-runner
\build\testWorker.js:275:16)
          at runTest (C:\Users\admin\nextjs\
my-demo-app\node_modules\jest-runner\build\t
estWorker.js:343:7)
          at Object.worker (C:\Users\admin\n
extjs\my-demo-app\node_modules\jest-runner\b
uild\testWorker.js:497:12)

    [0m [90m 107 |[39m             
[36mreturn[39m leaderboard[33m;[39m
     [90m 108 |[39m         } 
[36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 109 |[39m    
         console[33m.[39merror([32m'[Dona
tionService] Error getting 
leaderboard:'[39m[33m,[39m 
error)[33m;[39m
     [90m     |[39m                     
[31m[1m^[22m[39m
     [90m 110 |[39m             
[36mreturn[39m [][33m;[39m
     [90m 111 |[39m         }
     [90m 112 |[39m     }[33m,[39m[0m

      at Object.getLeaderboard 
(services/donation.service.ts:109:21)
      at Object.<anonymous> (__tests__/servi
ces/donation.service.test.ts:137:50)

    console.error
      [DonationService] Error getting 
leaderboard: TypeError: supabase_1.supabase.
from(...).select(...).eq(...).eq is not a 
function
          at Object.getLeaderboard (C:\Users
\admin\nextjs\my-demo-app\services\donation.
service.ts:78:18)
          at Object.<anonymous> (C:\Users\ad
min\nextjs\my-demo-app\__tests__\services\do
nation.service.test.ts:152:50)
          at Promise.finally.completed (C:\U
sers\admin\nextjs\my-demo-app\node_modules\j
est-circus\build\jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (C:\Users\adm
in\nextjs\my-demo-app\node_modules\jest-circ
us\build\jestAdapterInit.js:1497:10)
          at _callCircusTest (C:\Users\admin
\nextjs\my-demo-app\node_modules\jest-circus
\build\jestAdapterInit.js:1007:40)
          at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
          at _runTest (C:\Users\admin\nextjs
\my-demo-app\node_modules\jest-circus\build\
jestAdapterInit.js:947:3)
          at C:\Users\admin\nextjs\my-demo-a
pp\node_modules\jest-circus\build\jestAdapte
rInit.js:849:7
          at _runTestsForDescribeBlock (C:\U
sers\admin\nextjs\my-demo-app\node_modules\j
est-circus\build\jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (C:\U
sers\admin\nextjs\my-demo-app\node_modules\j
est-circus\build\jestAdapterInit.js:857:11)
          at _runTestsForDescribeBlock (C:\U
sers\admin\nextjs\my-demo-app\node_modules\j
est-circus\build\jestAdapterInit.js:857:11)
          at run (C:\Users\admin\nextjs\my-d
emo-app\node_modules\jest-circus\build\jestA
dapterInit.js:761:3)
          at 
runAndTransformResultsToJestFormat (C:\Users
\admin\nextjs\my-demo-app\node_modules\jest-
circus\build\jestAdapterInit.js:1918:21)
          at jestAdapter (C:\Users\admin\nex
tjs\my-demo-app\node_modules\jest-circus\bui
ld\runner.js:101:19)
          at runTestInternal (C:\Users\admin
\nextjs\my-demo-app\node_modules\jest-runner
\build\testWorker.js:275:16)
          at runTest (C:\Users\admin\nextjs\
my-demo-app\node_modules\jest-runner\build\t
estWorker.js:343:7)
          at Object.worker (C:\Users\admin\n
extjs\my-demo-app\node_modules\jest-runner\b
uild\testWorker.js:497:12)

    [0m [90m 107 |[39m             
[36mreturn[39m leaderboard[33m;[39m
     [90m 108 |[39m         } 
[36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 109 |[39m    
         console[33m.[39merror([32m'[Dona
tionService] Error getting 
leaderboard:'[39m[33m,[39m 
error)[33m;[39m
     [90m     |[39m                     
[31m[1m^[22m[39m
     [90m 110 |[39m             
[36mreturn[39m [][33m;[39m
     [90m 111 |[39m         }
     [90m 112 |[39m     }[33m,[39m[0m

      at Object.getLeaderboard 
(services/donation.service.ts:109:21)
      at Object.<anonymous> (__tests__/servi
ces/donation.service.test.ts:152:50)

    console.error
      [DonationService] Error creating 
donation: { message: 'Database error' }

    [0m [90m 144 |[39m             
[36mreturn[39m donation[33m;[39m
     [90m 145 |[39m         } 
[36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 146 |[39m    
         console[33m.[39merror([32m'[Dona
tionService] Error creating 
donation:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m                     
[31m[1m^[22m[39m
     [90m 147 |[39m             
[36mthrow[39m error[33m;[39m
     [90m 148 |[39m         }
     [90m 149 |[39m     }[33m,[39m[0m

      at Object.createDonation 
(services/donation.service.ts:146:21)
      at Object.<anonymous> (__tests__/servi
ces/donation.service.test.ts:238:13)

    console.error
      [DonationService] Error confirming 
payment: { message: 'Not found' }

    [0m [90m 164 |[39m             
[36mreturn[39m data[33m;[39m
     [90m 165 |[39m         } 
[36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 166 |[39m    
         console[33m.[39merror([32m'[Dona
tionService] Error confirming 
payment:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m                     
[31m[1m^[22m[39m
     [90m 167 |[39m             
[36mthrow[39m error[33m;[39m
     [90m 168 |[39m         }
     [90m 169 |[39m     }[0m

      at Object.confirmPayment 
(services/donation.service.ts:166:21)
      at Object.<anonymous> (__tests__/servi
ces/donation.service.test.ts:263:13)

  ΓùÅ donationService ΓÇ║ getLeaderboard 
ΓÇ║ should return sorted leaderboard by 
total amount

    expect(received).toBe(expected) // 
Object.is equality

    Expected: 2
    Received: 0

    [0m [90m 119 |[39m             
[36mconst[39m result [33m=[39m 
[36mawait[39m donationService[33m.[39mge
tLeaderboard([35m10[39m)[33m;[39m
     [90m 120 |[39m
    [31m[1m>[22m[39m[90m 121 |[39m    
         expect(result[33m.[39mlength)[33
m.[39mtoBe([35m2[39m)[33m;[39m
     [90m     |[39m                       
            [31m[1m^[22m[39m
     [90m 122 |[39m             expect(res
ult[[35m0[39m][33m.[39mdonor_name)[33m.
[39mtoBe([32m'Bob'[39m)[33m;[39m
     [90m 123 |[39m             expect(res
ult[[35m0[39m][33m.[39mtotal_amount)[33
m.[39mtoBe([35m200000[39m)[33m;[39m
     [90m 124 |[39m             expect(res
ult[[35m1[39m][33m.[39mdonor_name)[33m.
[39mtoBe([32m'Alice'[39m)[33m;[39m[0m

      at Object.<anonymous> (__tests__/servi
ces/donation.service.test.ts:121:35)

  ΓùÅ donationService ΓÇ║ getLeaderboard 
ΓÇ║ should exclude anonymous donations

    expect(received).toBe(expected) // 
Object.is equality

    Expected: 1
    Received: 0

    [0m [90m 137 |[39m             
[36mconst[39m result [33m=[39m 
[36mawait[39m donationService[33m.[39mge
tLeaderboard()[33m;[39m
     [90m 138 |[39m
    [31m[1m>[22m[39m[90m 139 |[39m    
         expect(result[33m.[39mlength)[33
m.[39mtoBe([35m1[39m)[33m;[39m
     [90m     |[39m                       
            [31m[1m^[22m[39m
     [90m 140 |[39m             expect(res
ult[[35m0[39m][33m.[39mdonor_name)[33m.
[39mtoBe([32m'Alice'[39m)[33m;[39m
     [90m 141 |[39m         })[33m;[39m
     [90m 142 |[39m[0m

      at Object.<anonymous> (__tests__/servi
ces/donation.service.test.ts:139:35)

  ΓùÅ donationService ΓÇ║ getLeaderboard 
ΓÇ║ should limit results

    expect(received).toBe(expected) // 
Object.is equality

    Expected: 5
    Received: 0

    [0m [90m 152 |[39m             
[36mconst[39m result [33m=[39m 
[36mawait[39m donationService[33m.[39mge
tLeaderboard([35m5[39m)[33m;[39m
     [90m 153 |[39m
    [31m[1m>[22m[39m[90m 154 |[39m    
         expect(result[33m.[39mlength)[33
m.[39mtoBe([35m5[39m)[33m;[39m
     [90m     |[39m                       
            [31m[1m^[22m[39m
     [90m 155 |[39m         })[33m;[39m
     [90m 156 |[39m
     [90m 157 |[39m         
test([32m'should return empty array on 
error'[39m[33m,[39m [36masync[39m () 
[33m=>[39m {[0m

      at Object.<anonymous> (__tests__/servi
ces/donation.service.test.ts:154:35)

PASS __tests__/services/donation-notificatio
n.test.ts
  ΓùÅ Console

    console.log
      Γ£à Loaded environment variables from 
.env.local for integration tests

      at Object.<anonymous> 
(jest.env.setup.js:19:13)

    console.error
      Failed to trigger donation email: 
Error: Internal Server Error
          at Object.<anonymous> (C:\Users\ad
min\nextjs\my-demo-app\__tests__\services\do
nation-notification.test.ts:79:55)
          at Promise.finally.completed (C:\U
sers\admin\nextjs\my-demo-app\node_modules\j
est-circus\build\jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (C:\Users\adm
in\nextjs\my-demo-app\node_modules\jest-circ
us\build\jestAdapterInit.js:1497:10)
          at _callCircusTest (C:\Users\admin
\nextjs\my-demo-app\node_modules\jest-circus
\build\jestAdapterInit.js:1007:40)
          at _runTest (C:\Users\admin\nextjs
\my-demo-app\node_modules\jest-circus\build\
jestAdapterInit.js:947:3)
          at C:\Users\admin\nextjs\my-demo-a
pp\node_modules\jest-circus\build\jestAdapte
rInit.js:849:7
          at _runTestsForDescribeBlock (C:\U
sers\admin\nextjs\my-demo-app\node_modules\j
est-circus\build\jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (C:\U
sers\admin\nextjs\my-demo-app\node_modules\j
est-circus\build\jestAdapterInit.js:857:11)
          at run (C:\Users\admin\nextjs\my-d
emo-app\node_modules\jest-circus\build\jestA
dapterInit.js:761:3)
          at 
runAndTransformResultsToJestFormat (C:\Users
\admin\nextjs\my-demo-app\node_modules\jest-
circus\build\jestAdapterInit.js:1918:21)
          at jestAdapter (C:\Users\admin\nex
tjs\my-demo-app\node_modules\jest-circus\bui
ld\runner.js:101:19)
          at runTestInternal (C:\Users\admin
\nextjs\my-demo-app\node_modules\jest-runner
\build\testWorker.js:275:16)
          at runTest (C:\Users\admin\nextjs\
my-demo-app\node_modules\jest-runner\build\t
estWorker.js:343:7)
          at Object.worker (C:\Users\admin\n
extjs\my-demo-app\node_modules\jest-runner\b
uild\testWorker.js:497:12)

    [0m [90m 33 |[39m                    
     volumeMl
     [90m 34 |[39m                     
})[33m,[39m
    [31m[1m>[22m[39m[90m 35 |[39m     
            
})[33m.[39m[36mcatch[39m(err 
[33m=>[39m 
console[33m.[39merror([32m'Failed to 
trigger donation email:'[39m[33m,[39m 
err))[33m;[39m
     [90m    |[39m                        
                 [31m[1m^[22m[39m
     [90m 36 |[39m             }
     [90m 37 |[39m
     [90m 38 |[39m             [90m// 
Trigger on_donation_verified sß║╜ tß╗▒ 
─æß╗Öng:[39m[0m

      at services/blood.service.ts:35:41

FAIL 
__tests__/services/point.service.test.ts
  ΓùÅ Console

    console.log
      Γ£à Loaded environment variables from 
.env.local for integration tests

      at Object.<anonymous> 
(jest.env.setup.js:19:13)

    console.error
      [PointService] Error redeeming 
voucher: TypeError: supabase_1.supabase.from
(...).select(...).eq(...).single is not a 
function
          at Object.redeemVoucher (C:\Users\
admin\nextjs\my-demo-app\services\point.serv
ice.ts:75:75)
          at Object.<anonymous> (C:\Users\ad
min\nextjs\my-demo-app\__tests__\services\po
int.service.test.ts:137:47)
          at Promise.finally.completed (C:\U
sers\admin\nextjs\my-demo-app\node_modules\j
est-circus\build\jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (C:\Users\adm
in\nextjs\my-demo-app\node_modules\jest-circ
us\build\jestAdapterInit.js:1497:10)
          at _callCircusTest (C:\Users\admin
\nextjs\my-demo-app\node_modules\jest-circus
\build\jestAdapterInit.js:1007:40)
          at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
          at _runTest (C:\Users\admin\nextjs
\my-demo-app\node_modules\jest-circus\build\
jestAdapterInit.js:947:3)
          at C:\Users\admin\nextjs\my-demo-a
pp\node_modules\jest-circus\build\jestAdapte
rInit.js:849:7
          at _runTestsForDescribeBlock (C:\U
sers\admin\nextjs\my-demo-app\node_modules\j
est-circus\build\jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (C:\U
sers\admin\nextjs\my-demo-app\node_modules\j
est-circus\build\jestAdapterInit.js:857:11)
          at _runTestsForDescribeBlock (C:\U
sers\admin\nextjs\my-demo-app\node_modules\j
est-circus\build\jestAdapterInit.js:857:11)
          at run (C:\Users\admin\nextjs\my-d
emo-app\node_modules\jest-circus\build\jestA
dapterInit.js:761:3)
          at 
runAndTransformResultsToJestFormat (C:\Users
\admin\nextjs\my-demo-app\node_modules\jest-
circus\build\jestAdapterInit.js:1918:21)
          at jestAdapter (C:\Users\admin\nex
tjs\my-demo-app\node_modules\jest-circus\bui
ld\runner.js:101:19)
          at runTestInternal (C:\Users\admin
\nextjs\my-demo-app\node_modules\jest-runner
\build\testWorker.js:275:16)
          at runTest (C:\Users\admin\nextjs\
my-demo-app\node_modules\jest-runner\build\t
estWorker.js:343:7)
          at Object.worker (C:\Users\admin\n
extjs\my-demo-app\node_modules\jest-runner\b
uild\testWorker.js:497:12)

    [0m [90m 121 |[39m             
[36mreturn[39m { success[33m:[39m 
[36mtrue[39m[33m,[39m redemption 
}[33m;[39m
     [90m 122 |[39m         } 
[36mcatch[39m (error[33m:[39m any) {
    [31m[1m>[22m[39m[90m 123 |[39m    
         console[33m.[39merror([32m'[Poin
tService] Error redeeming 
voucher:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m                     
[31m[1m^[22m[39m
     [90m 124 |[39m             
[36mthrow[39m error[33m;[39m
     [90m 125 |[39m         }
     [90m 126 |[39m     }[33m,[39m[0m

      at Object.redeemVoucher 
(services/point.service.ts:123:21)
      at Object.<anonymous> (__tests__/servi
ces/point.service.test.ts:137:47)

  ΓùÅ pointService ΓÇ║ redeemVoucher ΓÇ║ 
should redeem voucher successfully

    TypeError: supabase_1.supabase.from(...)
.select(...).eq(...).single is not a 
function

    [0m [90m 73 |[39m             
[90m// 1. Lß║Ñy th├┤ng tin voucher v├á 
ng╞░ß╗¥i d├╣ng[39m
     [90m 74 |[39m             
[36mconst[39m [{ data[33m:[39m voucher 
}[33m,[39m { data[33m:[39m user }] 
[33m=[39m [36mawait[39m 
[33mPromise[39m[33m.[39mall([
    [31m[1m>[22m[39m[90m 75 |[39m     
            supabase[33m.[39m[36mfrom[39
m([32m'vouchers'[39m)[33m.[39mselect([3
2m'*'[39m)[33m.[39meq([32m'id'[39m[33m
,[39m 
voucherId)[33m.[39msingle()[33m,[39m
     [90m    |[39m                        
                                            
       [31m[1m^[22m[39m
     [90m 76 |[39m                 supabas
e[33m.[39m[36mfrom[39m([32m'users'[39m
)[33m.[39mselect([32m'current_points'[39
m)[33m.[39meq([32m'id'[39m[33m,[39m 
userId)[33m.[39msingle()
     [90m 77 |[39m             
])[33m;[39m
     [90m 78 |[39m[0m

      at Object.redeemVoucher 
(services/point.service.ts:75:75)
      at Object.<anonymous> (__tests__/servi
ces/point.service.test.ts:137:47)

PASS 
__tests__/services/voucher.service.test.ts
  ΓùÅ Console

    console.log
      Γ£à Loaded environment variables from 
.env.local for integration tests

      at Object.<anonymous> 
(jest.env.setup.js:19:13)

PASS __tests__/services/user.service.test.ts
  ΓùÅ Console

    console.log
      Γ£à Loaded environment variables from 
.env.local for integration tests

      at Object.<anonymous> 
(jest.env.setup.js:19:13)

FAIL 
__tests__/services/setting.service.test.ts
  ΓùÅ Console

    console.log
      Γ£à Loaded environment variables from 
.env.local for integration tests

      at Object.<anonymous> 
(jest.env.setup.js:19:13)

  ΓùÅ settingService ΓÇ║ getSettings ΓÇ║ 
should return default settings when no data

    TypeError: Cannot read properties of 
null (reading 'ai_sensitivity')

    [0m [90m 85 |[39m             
[36mconst[39m result [33m=[39m 
[36mawait[39m settingService[33m.[39mget
Settings()[33m;[39m
     [90m 86 |[39m
    [31m[1m>[22m[39m[90m 87 |[39m     
        expect(result[33m.[39mai_sensitivi
ty)[33m.[39mtoBe([35m7[39m)[33m;[39m
     [90m    |[39m                        
   [31m[1m^[22m[39m
     [90m 88 |[39m             expect(resu
lt[33m.[39mpoints_per_donation)[33m.[39m
toBe([35m1000[39m)[33m;[39m
     [90m 89 |[39m
     [90m 90 |[39m             consoleSpy
[33m.[39mmockRestore()[33m;[39m[0m

      at Object.<anonymous> (__tests__/servi
ces/setting.service.test.ts:87:27)

PASS 
__tests__/services/blood.service.test.ts
  ΓùÅ Console

    console.log
      Γ£à Loaded environment variables from 
.env.local for integration tests

      at Object.<anonymous> 
(jest.env.setup.js:19:13)

PASS 
__tests__/services/hospital.service.test.ts
  ΓùÅ Console

    console.log
      Γ£à Loaded environment variables from 
.env.local for integration tests

      at Object.<anonymous> 
(jest.env.setup.js:19:13)

PASS __tests__/services/campaign-notificatio
n.test.ts
  ΓùÅ Console

    console.log
      Γ£à Loaded environment variables from 
.env.local for integration tests

      at Object.<anonymous> 
(jest.env.setup.js:19:13)

    console.error
      Error triggering campaign email: 
Error: SMTP Timeout
          at Object.<anonymous> (C:\Users\ad
min\nextjs\my-demo-app\__tests__\services\ca
mpaign-notification.test.ts:125:55)
          at Promise.finally.completed (C:\U
sers\admin\nextjs\my-demo-app\node_modules\j
est-circus\build\jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (C:\Users\adm
in\nextjs\my-demo-app\node_modules\jest-circ
us\build\jestAdapterInit.js:1497:10)
          at _callCircusTest (C:\Users\admin
\nextjs\my-demo-app\node_modules\jest-circus
\build\jestAdapterInit.js:1007:40)
          at _runTest (C:\Users\admin\nextjs
\my-demo-app\node_modules\jest-circus\build\
jestAdapterInit.js:947:3)
          at C:\Users\admin\nextjs\my-demo-a
pp\node_modules\jest-circus\build\jestAdapte
rInit.js:849:7
          at _runTestsForDescribeBlock (C:\U
sers\admin\nextjs\my-demo-app\node_modules\j
est-circus\build\jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (C:\U
sers\admin\nextjs\my-demo-app\node_modules\j
est-circus\build\jestAdapterInit.js:857:11)
          at run (C:\Users\admin\nextjs\my-d
emo-app\node_modules\jest-circus\build\jestA
dapterInit.js:761:3)
          at 
runAndTransformResultsToJestFormat (C:\Users
\admin\nextjs\my-demo-app\node_modules\jest-
circus\build\jestAdapterInit.js:1918:21)
          at jestAdapter (C:\Users\admin\nex
tjs\my-demo-app\node_modules\jest-circus\bui
ld\runner.js:101:19)
          at runTestInternal (C:\Users\admin
\nextjs\my-demo-app\node_modules\jest-runner
\build\testWorker.js:275:16)
          at runTest (C:\Users\admin\nextjs\
my-demo-app\node_modules\jest-runner\build\t
estWorker.js:343:7)
          at Object.worker (C:\Users\admin\n
extjs\my-demo-app\node_modules\jest-runner\b
uild\testWorker.js:497:12)

    [0m [90m 21 |[39m         }
     [90m 22 |[39m     } [36mcatch[39m 
(emailError) {
    [31m[1m>[22m[39m[90m 23 |[39m     
    console[33m.[39merror([32m'Error 
triggering campaign email:'[39m[33m,[39m 
emailError)[33m;[39m
     [90m    |[39m                 
[31m[1m^[22m[39m
     [90m 24 |[39m         [90m// Kh├┤ng 
throw error ─æß╗â kh├┤ng ß║únh h╞░ß╗ƒng 
─æß║┐n viß╗çc tß║ío chiß║┐n dß╗ïch[39m
     [90m 25 |[39m     }
     [90m 26 |[39m }[0m

      at triggerCampaignEmail 
(services/campaign.service.ts:23:17)

PASS 
__tests__/services/campaign.service.test.ts
  ΓùÅ Console

    console.log
      Γ£à Loaded environment variables from 
.env.local for integration tests

      at Object.<anonymous> 
(jest.env.setup.js:19:13)

    console.error
      Error triggering campaign email: 
Error: Email API failed
          at Object.<anonymous> (C:\Users\ad
min\nextjs\my-demo-app\__tests__\services\ca
mpaign.service.test.ts:116:55)
          at Promise.finally.completed (C:\U
sers\admin\nextjs\my-demo-app\node_modules\j
est-circus\build\jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (C:\Users\adm
in\nextjs\my-demo-app\node_modules\jest-circ
us\build\jestAdapterInit.js:1497:10)
          at _callCircusTest (C:\Users\admin
\nextjs\my-demo-app\node_modules\jest-circus
\build\jestAdapterInit.js:1007:40)
          at _runTest (C:\Users\admin\nextjs
\my-demo-app\node_modules\jest-circus\build\
jestAdapterInit.js:947:3)
          at C:\Users\admin\nextjs\my-demo-a
pp\node_modules\jest-circus\build\jestAdapte
rInit.js:849:7
          at _runTestsForDescribeBlock (C:\U
sers\admin\nextjs\my-demo-app\node_modules\j
est-circus\build\jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (C:\U
sers\admin\nextjs\my-demo-app\node_modules\j
est-circus\build\jestAdapterInit.js:857:11)
          at run (C:\Users\admin\nextjs\my-d
emo-app\node_modules\jest-circus\build\jestA
dapterInit.js:761:3)
          at 
runAndTransformResultsToJestFormat (C:\Users
\admin\nextjs\my-demo-app\node_modules\jest-
circus\build\jestAdapterInit.js:1918:21)
          at jestAdapter (C:\Users\admin\nex
tjs\my-demo-app\node_modules\jest-circus\bui
ld\runner.js:101:19)
          at runTestInternal (C:\Users\admin
\nextjs\my-demo-app\node_modules\jest-runner
\build\testWorker.js:275:16)
          at runTest (C:\Users\admin\nextjs\
my-demo-app\node_modules\jest-runner\build\t
estWorker.js:343:7)
          at Object.worker (C:\Users\admin\n
extjs\my-demo-app\node_modules\jest-runner\b
uild\testWorker.js:497:12)

    [0m [90m 21 |[39m         }
     [90m 22 |[39m     } [36mcatch[39m 
(emailError) {
    [31m[1m>[22m[39m[90m 23 |[39m     
    console[33m.[39merror([32m'Error 
triggering campaign email:'[39m[33m,[39m 
emailError)[33m;[39m
     [90m    |[39m                 
[31m[1m^[22m[39m
     [90m 24 |[39m         [90m// Kh├┤ng 
throw error ─æß╗â kh├┤ng ß║únh h╞░ß╗ƒng 
─æß║┐n viß╗çc tß║ío chiß║┐n dß╗ïch[39m
     [90m 25 |[39m     }
     [90m 26 |[39m }[0m

      at triggerCampaignEmail 
(services/campaign.service.ts:23:17)

    console.error
      Failed to send campaign 
notifications: Error: Notification failed
          at Object.<anonymous> (C:\Users\ad
min\nextjs\my-demo-app\__tests__\services\ca
mpaign.service.test.ts:210:72)
          at Promise.finally.completed (C:\U
sers\admin\nextjs\my-demo-app\node_modules\j
est-circus\build\jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (C:\Users\adm
in\nextjs\my-demo-app\node_modules\jest-circ
us\build\jestAdapterInit.js:1497:10)
          at _callCircusTest (C:\Users\admin
\nextjs\my-demo-app\node_modules\jest-circus
\build\jestAdapterInit.js:1007:40)
          at _runTest (C:\Users\admin\nextjs
\my-demo-app\node_modules\jest-circus\build\
jestAdapterInit.js:947:3)
          at C:\Users\admin\nextjs\my-demo-a
pp\node_modules\jest-circus\build\jestAdapte
rInit.js:849:7
          at _runTestsForDescribeBlock (C:\U
sers\admin\nextjs\my-demo-app\node_modules\j
est-circus\build\jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (C:\U
sers\admin\nextjs\my-demo-app\node_modules\j
est-circus\build\jestAdapterInit.js:857:11)
          at run (C:\Users\admin\nextjs\my-d
emo-app\node_modules\jest-circus\build\jestA
dapterInit.js:761:3)
          at 
runAndTransformResultsToJestFormat (C:\Users
\admin\nextjs\my-demo-app\node_modules\jest-
circus\build\jestAdapterInit.js:1918:21)
          at jestAdapter (C:\Users\admin\nex
tjs\my-demo-app\node_modules\jest-circus\bui
ld\runner.js:101:19)
          at runTestInternal (C:\Users\admin
\nextjs\my-demo-app\node_modules\jest-runner
\build\testWorker.js:275:16)
          at runTest (C:\Users\admin\nextjs\
my-demo-app\node_modules\jest-runner\build\t
estWorker.js:343:7)
          at Object.worker (C:\Users\admin\n
extjs\my-demo-app\node_modules\jest-runner\b
uild\testWorker.js:497:12)

    [0m [90m 108 |[39m             
[36mawait[39m notificationService[33m.[3
9msendCampaignNotification(data[33m.[39mid
)[33m;[39m
     [90m 109 |[39m         } 
[36mcatch[39m (notifError) {
    [31m[1m>[22m[39m[90m 110 |[39m    
         
console[33m.[39merror([32m'Failed to 
send campaign 
notifications:'[39m[33m,[39m 
notifError)[33m;[39m
     [90m     |[39m                     
[31m[1m^[22m[39m
     [90m 111 |[39m             [90m// 
Kh├┤ng throw error ─æß╗â kh├┤ng ß║únh 
h╞░ß╗ƒng ─æß║┐n viß╗çc tß║ío chiß║┐n 
dß╗ïch[39m
     [90m 112 |[39m         }
     [90m 113 |[39m[0m

      at Object.createCampaign 
(services/campaign.service.ts:110:21)
      at Object.<anonymous> (__tests__/servi
ces/campaign.service.test.ts:231:24)

PASS __tests__/services/notification.service
.test.ts
  ΓùÅ Console

    console.log
      Γ£à Loaded environment variables from 
.env.local for integration tests

      at Object.<anonymous> 
(jest.env.setup.js:19:13)

    console.log
      --- NOTIFICATION DEBUG: Input Data 
--- {
        user_id: 'hospital-123',
        title: '≡ƒæñ C├│ ng╞░ß╗¥i ─æ─âng 
k├╜ mß╗¢i!',
        content: 'Nguyß╗àn V─ân A vß╗½a 
─æ─âng k├╜ tham gia chiß║┐n dß╗ïch "Chiß║┐n 
dß╗ïch test". Nhß║Ñn ─æß╗â xem danh s├ích.',
        is_read: false,
        action_type: 'view_registrations',
        action_url: '/hospital-campaign/camp
aign-123?tab=registrations',
        metadata: {
          campaign_id: 'campaign-123',
          campaign_name: 'Chiß║┐n dß╗ïch 
test',
          donor_name: 'Nguyß╗àn V─ân A'
        }
      }

      at createNotification 
(services/notification.service.ts:136:17)

    console.log
      Γ£à Notified hospital about new 
registration: Nguyß╗àn V─ân A

      at 
Object.notifyHospitalNewRegistration 
(services/notification.service.ts:297:17)

    console.log
      --- NOTIFICATION DEBUG: Input Data 
--- {
        user_id: 'donor-123',
        title: 'Γ£à ─É─âng k├╜ th├ánh 
c├┤ng!',
        content: 'Bß║ín ─æ├ú ─æ─âng k├╜ 
tham gia chiß║┐n dß╗ïch "Chiß║┐n dß╗ïch 
Xu├ón 2026" th├ánh c├┤ng. Vui l├▓ng ─æß║┐n 
─æ├║ng giß╗¥!',
        is_read: false,
        action_type: 'view_appointment',
        action_url: 
'/appointments/appointment-789',
        metadata: {
          appointment_id: 'appointment-789',
          campaign_name: 'Chiß║┐n dß╗ïch 
Xu├ón 2026'
        }
      }

      at createNotification 
(services/notification.service.ts:136:17)

    console.log
      Γ£à Notified donor about successful 
registration

      at 
Object.notifyDonorRegistrationSuccess 
(services/notification.service.ts:325:17)

    console.log
      --- NOTIFICATION DEBUG: Input Data 
--- {
        user_id: 'user-123',
        title: 'Test Notification',
        content: 'Test content',
        is_read: false
      }

      at Object.createNotification 
(services/notification.service.ts:136:17)

PASS __tests__/auth/login.test.tsx
  ΓùÅ Console

    console.log
      Γ£à Loaded environment variables from 
.env.local for integration tests

      at Object.<anonymous> 
(jest.env.setup.js:19:13)

PASS __tests__/auth/register.test.tsx
  ΓùÅ Console

    console.log
      Γ£à Loaded environment variables from 
.env.local for integration tests

      at Object.<anonymous> 
(jest.env.setup.js:19:13)

    console.error
      Registration error: { message: 'User 
already registered' }

    [0m [90m 75 |[39m       }
     [90m 76 |[39m     } [36mcatch[39m 
(err[33m:[39m any) {
    [31m[1m>[22m[39m[90m 77 |[39m     
  
console[33m.[39merror([32m"Registration 
error:"[39m[33m,[39m err)[33m;[39m
     [90m    |[39m               
[31m[1m^[22m[39m
     [90m 78 |[39m       [90m// Map 
common Supabase Auth errors to Vietnamese 
messages[39m
     [90m 79 |[39m       [36mconst[39m 
errorMap[33m:[39m [33mRecord[39m[33m<[
39m[33mstring[39m[33m,[39m 
string[33m>[39m [33m=[39m {
     [90m 80 |[39m         [32m'User 
already registered'[39m[33m:[39m 
[32m'Email n├áy ─æ├ú ─æ╞░ß╗úc ─æ─âng k├╜. 
Vui l├▓ng ─æ─âng nhß║¡p hoß║╖c sß╗¡ dß╗Ñng 
email kh├íc.'[39m[33m,[39m[0m

      at handleRegister (C:\Users\admin\next
js\my-demo-app\app\(auth)../../../../registe
r/page.tsx:77:15)

FAIL 
__tests__/api/send-announcement.test.ts 
(8.318 s)
  ΓùÅ Console

    console.log
      Γ£à Loaded environment variables from 
.env.local for integration tests

      at Object.<anonymous> 
(jest.env.setup.js:19:13)

    console.log
      [API Campaign] Sending 
new_campaign_invite for campaign campaign-1

      at POST (app/api/campaign/send-announc
ement/route.ts:23:17)

    console.log
      [API Campaign] Found 1 potential 
donors for invite

      at POST (app/api/campaign/send-announc
ement/route.ts:60:21)

    console.error
      Error: Error: Parse Error: Duplicate 
Content-Length
          at Object.dispatchError (C:\Users\
admin\nextjs\my-demo-app\node_modules\jsdom\
lib\jsdom\living\xhr\xhr-utils.js:62:19)
          at EventEmitter.<anonymous> (C:\Us
ers\admin\nextjs\my-demo-app\node_modules\js
dom\lib\jsdom\living\xhr\XMLHttpRequest-impl
.js:655:18)
          at EventEmitter.emit 
(node:events:531:35)
          at Request.<anonymous> (C:\Users\a
dmin\nextjs\my-demo-app\node_modules\jsdom\l
ib\jsdom\living\xhr\xhr-utils.js:380:14)
          at Request.emit 
(node:events:519:28)
          at ClientRequest.<anonymous> (C:\U
sers\admin\nextjs\my-demo-app\node_modules\j
sdom\lib\jsdom\living\helpers\http-request.j
s:127:14)
          at ClientRequest.emit 
(node:events:519:28)
          at emitErrorEvent 
(node:_http_client:105:11)
          at TLSSocket.socketOnData 
(node:_http_client:567:5)
          at TLSSocket.emit 
(node:events:519:28)
          at addChunk 
(node:internal/streams/readable:561:12)
          at readableAddChunkPushByteMode 
(node:internal/streams/readable:512:3)
          at TLSSocket.Readable.push 
(node:internal/streams/readable:392:5)
          at TLSWrap.onStreamRead 
(node:internal/stream_base_commons:189:23)
          at TLSWrap.callbackTrampoline 
(node:internal/async_hooks:130:17) {
        type: 'XMLHttpRequest'
      }

      at VirtualConsole.<anonymous> (node_mo
dules/@jest/environment-jsdom-abstract/build
/index.js:87:23)
      at Object.dispatchError (node_modules/
jsdom/lib/jsdom/living/xhr/xhr-utils.js:65:5
3)
      at EventEmitter.<anonymous> (node_modu
les/jsdom/lib/jsdom/living/xhr/XMLHttpReques
t-impl.js:655:18)
      at Request.<anonymous> (node_modules/j
sdom/lib/jsdom/living/xhr/xhr-utils.js:380:1
4)
      at ClientRequest.<anonymous> (node_mod
ules/jsdom/lib/jsdom/living/helpers/http-req
uest.js:127:14)

    console.error
      [Email Error] Failed invite for 
hcm@test.com: Network Error

    [0m [90m 87 |[39m                    
     [36mreturn[39m { success[33m:[39m 
[36mtrue[39m[33m,[39m email[33m:[39m 
user[33m.[39memail }[33m;[39m
     [90m 88 |[39m                     } 
[36mcatch[39m (err[33m:[39m any) {
    [31m[1m>[22m[39m[90m 89 |[39m     
                    
console[33m.[39merror([32m`[Email Error] 
Failed invite for 
${user?.email}:`[39m[33m,[39m err[33m.[
39mresponse[33m?[39m[33m.[39mbody 
[33m||[39m 
err[33m.[39mmessage)[33m;[39m
     [90m    |[39m                        
         [31m[1m^[22m[39m
     [90m 90 |[39m                        
 [36mconst[39m errorMessage [33m=[39m er
r[33m.[39mresponse[33m?[39m[33m.[39mbo
dy[33m?[39m[33m.[39merrors[33m?[39m[3
3m.[39m[[35m0[39m][33m?[39m[33m.[39mm
essage [33m||[39m 
err[33m.[39mmessage[33m;[39m
     [90m 91 |[39m                        
 [36mreturn[39m { success[33m:[39m 
[36mfalse[39m[33m,[39m email[33m:[39m 
user[33m.[39memail[33m,[39m 
error[33m:[39m errorMessage }[33m;[39m
     [90m 92 |[39m                     
}[0m

      at app/api/campaign/send-announcement/
route.ts:89:33
          at async Promise.all (index 0)
      at POST (app/api/campaign/send-announc
ement/route.ts:62:27)
      at Object.<anonymous> (__tests__/api/s
end-announcement.test.ts:94:13)

    console.error
      [API Campaign] Some emails failed: [ 
{ success: false, email: 'hcm@test.com', 
error: 'Network Error' } ]

    [0m [90m 184 |[39m
     [90m 185 |[39m         [36mif[39m 
(failedDetails[33m.[39mlength [33m>[39m 
[35m0[39m) {
    [31m[1m>[22m[39m[90m 186 |[39m    
         console[33m.[39merror([32m'[API 
Campaign] Some emails 
failed:'[39m[33m,[39m 
failedDetails)[33m;[39m
     [90m     |[39m                     
[31m[1m^[22m[39m
     [90m 187 |[39m         }
     [90m 188 |[39m
     [90m 189 |[39m         
[36mreturn[39m 
[33mNextResponse[39m[33m.[39mjson({[0m

      at POST (app/api/campaign/send-announc
ement/route.ts:186:21)
      at Object.<anonymous> (__tests__/api/s
end-announcement.test.ts:94:13)

    console.log
      [API Campaign] Sending 
new_campaign_invite for campaign campaign-2

      at POST (app/api/campaign/send-announc
ement/route.ts:23:17)

    console.log
      [API Campaign] Found 1 potential 
donors for invite

      at POST (app/api/campaign/send-announc
ement/route.ts:60:21)

    console.error
      Error: Error: Parse Error: Duplicate 
Content-Length
          at Object.dispatchError (C:\Users\
admin\nextjs\my-demo-app\node_modules\jsdom\
lib\jsdom\living\xhr\xhr-utils.js:62:19)
          at EventEmitter.<anonymous> (C:\Us
ers\admin\nextjs\my-demo-app\node_modules\js
dom\lib\jsdom\living\xhr\XMLHttpRequest-impl
.js:655:18)
          at EventEmitter.emit 
(node:events:531:35)
          at Request.<anonymous> (C:\Users\a
dmin\nextjs\my-demo-app\node_modules\jsdom\l
ib\jsdom\living\xhr\xhr-utils.js:380:14)
          at Request.emit 
(node:events:519:28)
          at ClientRequest.<anonymous> (C:\U
sers\admin\nextjs\my-demo-app\node_modules\j
sdom\lib\jsdom\living\helpers\http-request.j
s:127:14)
          at ClientRequest.emit 
(node:events:519:28)
          at emitErrorEvent 
(node:_http_client:105:11)
          at TLSSocket.socketOnData 
(node:_http_client:567:5)
          at TLSSocket.emit 
(node:events:519:28)
          at addChunk 
(node:internal/streams/readable:561:12)
          at readableAddChunkPushByteMode 
(node:internal/streams/readable:512:3)
          at TLSSocket.Readable.push 
(node:internal/streams/readable:392:5)
          at TLSWrap.onStreamRead 
(node:internal/stream_base_commons:189:23)
          at TLSWrap.callbackTrampoline 
(node:internal/async_hooks:130:17) {
        type: 'XMLHttpRequest'
      }

      at VirtualConsole.<anonymous> (node_mo
dules/@jest/environment-jsdom-abstract/build
/index.js:87:23)
      at Object.dispatchError (node_modules/
jsdom/lib/jsdom/living/xhr/xhr-utils.js:65:5
3)
      at EventEmitter.<anonymous> (node_modu
les/jsdom/lib/jsdom/living/xhr/XMLHttpReques
t-impl.js:655:18)
      at Request.<anonymous> (node_modules/j
sdom/lib/jsdom/living/xhr/xhr-utils.js:380:1
4)
      at ClientRequest.<anonymous> (node_mod
ules/jsdom/lib/jsdom/living/helpers/http-req
uest.js:127:14)

    console.error
      [Email Error] Failed invite for 
ab@test.com: Network Error

    [0m [90m 87 |[39m                    
     [36mreturn[39m { success[33m:[39m 
[36mtrue[39m[33m,[39m email[33m:[39m 
user[33m.[39memail }[33m;[39m
     [90m 88 |[39m                     } 
[36mcatch[39m (err[33m:[39m any) {
    [31m[1m>[22m[39m[90m 89 |[39m     
                    
console[33m.[39merror([32m`[Email Error] 
Failed invite for 
${user?.email}:`[39m[33m,[39m err[33m.[
39mresponse[33m?[39m[33m.[39mbody 
[33m||[39m 
err[33m.[39mmessage)[33m;[39m
     [90m    |[39m                        
         [31m[1m^[22m[39m
     [90m 90 |[39m                        
 [36mconst[39m errorMessage [33m=[39m er
r[33m.[39mresponse[33m?[39m[33m.[39mbo
dy[33m?[39m[33m.[39merrors[33m?[39m[3
3m.[39m[[35m0[39m][33m?[39m[33m.[39mm
essage [33m||[39m 
err[33m.[39mmessage[33m;[39m
     [90m 91 |[39m                        
 [36mreturn[39m { success[33m:[39m 
[36mfalse[39m[33m,[39m email[33m:[39m 
user[33m.[39memail[33m,[39m 
error[33m:[39m errorMessage }[33m;[39m
     [90m 92 |[39m                     
}[0m

      at app/api/campaign/send-announcement/
route.ts:89:33
          at async Promise.all (index 0)
      at POST (app/api/campaign/send-announc
ement/route.ts:62:27)
      at Object.<anonymous> (__tests__/api/s
end-announcement.test.ts:132:13)

    console.error
      [API Campaign] Some emails failed: [ 
{ success: false, email: 'ab@test.com', 
error: 'Network Error' } ]

    [0m [90m 184 |[39m
     [90m 185 |[39m         [36mif[39m 
(failedDetails[33m.[39mlength [33m>[39m 
[35m0[39m) {
    [31m[1m>[22m[39m[90m 186 |[39m    
         console[33m.[39merror([32m'[API 
Campaign] Some emails 
failed:'[39m[33m,[39m 
failedDetails)[33m;[39m
     [90m     |[39m                     
[31m[1m^[22m[39m
     [90m 187 |[39m         }
     [90m 188 |[39m
     [90m 189 |[39m         
[36mreturn[39m 
[33mNextResponse[39m[33m.[39mjson({[0m

      at POST (app/api/campaign/send-announc
ement/route.ts:186:21)
      at Object.<anonymous> (__tests__/api/s
end-announcement.test.ts:132:13)

    console.log
      [API Campaign] Sending 
new_campaign_invite for campaign campaign-3

      at POST (app/api/campaign/send-announc
ement/route.ts:23:17)

    console.error
      [API Campaign] Global error: 
TypeError: supabase_admin_1.supabaseAdmin.fr
om(...).select(...).eq(...).eq is not a 
function
          at POST (C:\Users\admin\nextjs\my-
demo-app\app\api\campaign\send-announcement\
route.ts:52:18)
          at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
          at Object.<anonymous> (C:\Users\ad
min\nextjs\my-demo-app\__tests__\api\send-an
nouncement.test.ts:183:13)

    [0m [90m 193 |[39m         
})[33m;[39m
     [90m 194 |[39m     } [36mcatch[39m 
(error[33m:[39m any) {
    [31m[1m>[22m[39m[90m 195 |[39m    
     console[33m.[39merror([32m'[API 
Campaign] Global error:'[39m[33m,[39m 
error)[33m;[39m
     [90m     |[39m                 
[31m[1m^[22m[39m
     [90m 196 |[39m         
[36mreturn[39m 
[33mNextResponse[39m[33m.[39mjson({ 
error[33m:[39m error[33m.[39mmessage 
[33m||[39m [32m'Internal Server 
Error'[39m }[33m,[39m { 
status[33m:[39m [35m500[39m 
})[33m;[39m
     [90m 197 |[39m     }
     [90m 198 |[39m }[0m

      at POST (app/api/campaign/send-announc
ement/route.ts:195:17)
      at Object.<anonymous> (__tests__/api/s
end-announcement.test.ts:183:13)

    console.log
      [API Campaign] Sending 
new_campaign_invite for campaign campaign-4

      at POST (app/api/campaign/send-announc
ement/route.ts:23:17)

    console.log
      [API Campaign] Found 1 potential 
donors for invite

      at POST (app/api/campaign/send-announc
ement/route.ts:60:21)

    console.error
      Error: Error: Parse Error: Duplicate 
Content-Length
          at Object.dispatchError (C:\Users\
admin\nextjs\my-demo-app\node_modules\jsdom\
lib\jsdom\living\xhr\xhr-utils.js:62:19)
          at EventEmitter.<anonymous> (C:\Us
ers\admin\nextjs\my-demo-app\node_modules\js
dom\lib\jsdom\living\xhr\XMLHttpRequest-impl
.js:655:18)
          at EventEmitter.emit 
(node:events:531:35)
          at Request.<anonymous> (C:\Users\a
dmin\nextjs\my-demo-app\node_modules\jsdom\l
ib\jsdom\living\xhr\xhr-utils.js:380:14)
          at Request.emit 
(node:events:519:28)
          at ClientRequest.<anonymous> (C:\U
sers\admin\nextjs\my-demo-app\node_modules\j
sdom\lib\jsdom\living\helpers\http-request.j
s:127:14)
          at ClientRequest.emit 
(node:events:519:28)
          at emitErrorEvent 
(node:_http_client:105:11)
          at TLSSocket.socketOnData 
(node:_http_client:567:5)
          at TLSSocket.emit 
(node:events:519:28)
          at addChunk 
(node:internal/streams/readable:561:12)
          at readableAddChunkPushByteMode 
(node:internal/streams/readable:512:3)
          at TLSSocket.Readable.push 
(node:internal/streams/readable:392:5)
          at TLSWrap.onStreamRead 
(node:internal/stream_base_commons:189:23)
          at TLSWrap.callbackTrampoline 
(node:internal/async_hooks:130:17) {
        type: 'XMLHttpRequest'
      }

      at VirtualConsole.<anonymous> (node_mo
dules/@jest/environment-jsdom-abstract/build
/index.js:87:23)
      at Object.dispatchError (node_modules/
jsdom/lib/jsdom/living/xhr/xhr-utils.js:65:5
3)
      at EventEmitter.<anonymous> (node_modu
les/jsdom/lib/jsdom/living/xhr/XMLHttpReques
t-impl.js:655:18)
      at Request.<anonymous> (node_modules/j
sdom/lib/jsdom/living/xhr/xhr-utils.js:380:1
4)
      at ClientRequest.<anonymous> (node_mod
ules/jsdom/lib/jsdom/living/helpers/http-req
uest.js:127:14)

    console.error
      [Email Error] Failed invite for 
john@test.com: Network Error

    [0m [90m 87 |[39m                    
     [36mreturn[39m { success[33m:[39m 
[36mtrue[39m[33m,[39m email[33m:[39m 
user[33m.[39memail }[33m;[39m
     [90m 88 |[39m                     } 
[36mcatch[39m (err[33m:[39m any) {
    [31m[1m>[22m[39m[90m 89 |[39m     
                    
console[33m.[39merror([32m`[Email Error] 
Failed invite for 
${user?.email}:`[39m[33m,[39m err[33m.[
39mresponse[33m?[39m[33m.[39mbody 
[33m||[39m 
err[33m.[39mmessage)[33m;[39m
     [90m    |[39m                        
         [31m[1m^[22m[39m
     [90m 90 |[39m                        
 [36mconst[39m errorMessage [33m=[39m er
r[33m.[39mresponse[33m?[39m[33m.[39mbo
dy[33m?[39m[33m.[39merrors[33m?[39m[3
3m.[39m[[35m0[39m][33m?[39m[33m.[39mm
essage [33m||[39m 
err[33m.[39mmessage[33m;[39m
     [90m 91 |[39m                        
 [36mreturn[39m { success[33m:[39m 
[36mfalse[39m[33m,[39m email[33m:[39m 
user[33m.[39memail[33m,[39m 
error[33m:[39m errorMessage }[33m;[39m
     [90m 92 |[39m                     
}[0m

      at app/api/campaign/send-announcement/
route.ts:89:33
          at async Promise.all (index 0)
      at POST (app/api/campaign/send-announc
ement/route.ts:62:27)
      at Object.<anonymous> (__tests__/api/s
end-announcement.test.ts:228:30)

    console.error
      [API Campaign] Some emails failed: [ 
{ success: false, email: 'john@test.com', 
error: 'Network Error' } ]

    [0m [90m 184 |[39m
     [90m 185 |[39m         [36mif[39m 
(failedDetails[33m.[39mlength [33m>[39m 
[35m0[39m) {
    [31m[1m>[22m[39m[90m 186 |[39m    
         console[33m.[39merror([32m'[API 
Campaign] Some emails 
failed:'[39m[33m,[39m 
failedDetails)[33m;[39m
     [90m     |[39m                     
[31m[1m^[22m[39m
     [90m 187 |[39m         }
     [90m 188 |[39m
     [90m 189 |[39m         
[36mreturn[39m 
[33mNextResponse[39m[33m.[39mjson({[0m

      at POST (app/api/campaign/send-announc
ement/route.ts:186:21)
      at Object.<anonymous> (__tests__/api/s
end-announcement.test.ts:228:30)

    console.log
      [API Campaign] Sending 
new_campaign_invite for campaign campaign-5

      at POST (app/api/campaign/send-announc
ement/route.ts:23:17)

    console.log
      [API Campaign] Found 2 potential 
donors for invite

      at POST (app/api/campaign/send-announc
ement/route.ts:60:21)

    console.error
      Error: Error: Parse Error: Duplicate 
Content-Length
          at Object.dispatchError (C:\Users\
admin\nextjs\my-demo-app\node_modules\jsdom\
lib\jsdom\living\xhr\xhr-utils.js:62:19)
          at EventEmitter.<anonymous> (C:\Us
ers\admin\nextjs\my-demo-app\node_modules\js
dom\lib\jsdom\living\xhr\XMLHttpRequest-impl
.js:655:18)
          at EventEmitter.emit 
(node:events:531:35)
          at Request.<anonymous> (C:\Users\a
dmin\nextjs\my-demo-app\node_modules\jsdom\l
ib\jsdom\living\xhr\xhr-utils.js:380:14)
          at Request.emit 
(node:events:519:28)
          at ClientRequest.<anonymous> (C:\U
sers\admin\nextjs\my-demo-app\node_modules\j
sdom\lib\jsdom\living\helpers\http-request.j
s:127:14)
          at ClientRequest.emit 
(node:events:519:28)
          at emitErrorEvent 
(node:_http_client:105:11)
          at TLSSocket.socketOnData 
(node:_http_client:567:5)
          at TLSSocket.emit 
(node:events:519:28)
          at addChunk 
(node:internal/streams/readable:561:12)
          at readableAddChunkPushByteMode 
(node:internal/streams/readable:512:3)
          at TLSSocket.Readable.push 
(node:internal/streams/readable:392:5)
          at TLSWrap.onStreamRead 
(node:internal/stream_base_commons:189:23)
          at TLSWrap.callbackTrampoline 
(node:internal/async_hooks:130:17) {
        type: 'XMLHttpRequest'
      }

      at VirtualConsole.<anonymous> (node_mo
dules/@jest/environment-jsdom-abstract/build
/index.js:87:23)
      at Object.dispatchError (node_modules/
jsdom/lib/jsdom/living/xhr/xhr-utils.js:65:5
3)
      at EventEmitter.<anonymous> (node_modu
les/jsdom/lib/jsdom/living/xhr/XMLHttpReques
t-impl.js:655:18)
      at Request.<anonymous> (node_modules/j
sdom/lib/jsdom/living/xhr/xhr-utils.js:380:1
4)
      at ClientRequest.<anonymous> (node_mod
ules/jsdom/lib/jsdom/living/helpers/http-req
uest.js:127:14)

    console.error
      [Email Error] Failed invite for 
donor2@test.com: Network Error

    [0m [90m 87 |[39m                    
     [36mreturn[39m { success[33m:[39m 
[36mtrue[39m[33m,[39m email[33m:[39m 
user[33m.[39memail }[33m;[39m
     [90m 88 |[39m                     } 
[36mcatch[39m (err[33m:[39m any) {
    [31m[1m>[22m[39m[90m 89 |[39m     
                    
console[33m.[39merror([32m`[Email Error] 
Failed invite for 
${user?.email}:`[39m[33m,[39m err[33m.[
39mresponse[33m?[39m[33m.[39mbody 
[33m||[39m 
err[33m.[39mmessage)[33m;[39m
     [90m    |[39m                        
         [31m[1m^[22m[39m
     [90m 90 |[39m                        
 [36mconst[39m errorMessage [33m=[39m er
r[33m.[39mresponse[33m?[39m[33m.[39mbo
dy[33m?[39m[33m.[39merrors[33m?[39m[3
3m.[39m[[35m0[39m][33m?[39m[33m.[39mm
essage [33m||[39m 
err[33m.[39mmessage[33m;[39m
     [90m 91 |[39m                        
 [36mreturn[39m { success[33m:[39m 
[36mfalse[39m[33m,[39m email[33m:[39m 
user[33m.[39memail[33m,[39m 
error[33m:[39m errorMessage }[33m;[39m
     [90m 92 |[39m                     
}[0m

      at app/api/campaign/send-announcement/
route.ts:89:33
          at async Promise.all (index 1)
      at POST (app/api/campaign/send-announc
ement/route.ts:62:27)
      at Object.<anonymous> (__tests__/api/s
end-announcement.test.ts:278:30)

    console.error
      Error: Error: Parse Error: Duplicate 
Content-Length
          at Object.dispatchError (C:\Users\
admin\nextjs\my-demo-app\node_modules\jsdom\
lib\jsdom\living\xhr\xhr-utils.js:62:19)
          at EventEmitter.<anonymous> (C:\Us
ers\admin\nextjs\my-demo-app\node_modules\js
dom\lib\jsdom\living\xhr\XMLHttpRequest-impl
.js:655:18)
          at EventEmitter.emit 
(node:events:531:35)
          at Request.<anonymous> (C:\Users\a
dmin\nextjs\my-demo-app\node_modules\jsdom\l
ib\jsdom\living\xhr\xhr-utils.js:380:14)
          at Request.emit 
(node:events:519:28)
          at ClientRequest.<anonymous> (C:\U
sers\admin\nextjs\my-demo-app\node_modules\j
sdom\lib\jsdom\living\helpers\http-request.j
s:127:14)
          at ClientRequest.emit 
(node:events:519:28)
          at emitErrorEvent 
(node:_http_client:105:11)
          at TLSSocket.socketOnData 
(node:_http_client:567:5)
          at TLSSocket.emit 
(node:events:519:28)
          at addChunk 
(node:internal/streams/readable:561:12)
          at readableAddChunkPushByteMode 
(node:internal/streams/readable:512:3)
          at TLSSocket.Readable.push 
(node:internal/streams/readable:392:5)
          at TLSWrap.onStreamRead 
(node:internal/stream_base_commons:189:23)
          at TLSWrap.callbackTrampoline 
(node:internal/async_hooks:130:17) {
        type: 'XMLHttpRequest'
      }

      at VirtualConsole.<anonymous> (node_mo
dules/@jest/environment-jsdom-abstract/build
/index.js:87:23)
      at Object.dispatchError (node_modules/
jsdom/lib/jsdom/living/xhr/xhr-utils.js:65:5
3)
      at EventEmitter.<anonymous> (node_modu
les/jsdom/lib/jsdom/living/xhr/XMLHttpReques
t-impl.js:655:18)
      at Request.<anonymous> (node_modules/j
sdom/lib/jsdom/living/xhr/xhr-utils.js:380:1
4)
      at ClientRequest.<anonymous> (node_mod
ules/jsdom/lib/jsdom/living/helpers/http-req
uest.js:127:14)

    console.error
      [Email Error] Failed invite for 
donor1@test.com: Network Error

    [0m [90m 87 |[39m                    
     [36mreturn[39m { success[33m:[39m 
[36mtrue[39m[33m,[39m email[33m:[39m 
user[33m.[39memail }[33m;[39m
     [90m 88 |[39m                     } 
[36mcatch[39m (err[33m:[39m any) {
    [31m[1m>[22m[39m[90m 89 |[39m     
                    
console[33m.[39merror([32m`[Email Error] 
Failed invite for 
${user?.email}:`[39m[33m,[39m err[33m.[
39mresponse[33m?[39m[33m.[39mbody 
[33m||[39m 
err[33m.[39mmessage)[33m;[39m
     [90m    |[39m                        
         [31m[1m^[22m[39m
     [90m 90 |[39m                        
 [36mconst[39m errorMessage [33m=[39m er
r[33m.[39mresponse[33m?[39m[33m.[39mbo
dy[33m?[39m[33m.[39merrors[33m?[39m[3
3m.[39m[[35m0[39m][33m?[39m[33m.[39mm
essage [33m||[39m 
err[33m.[39mmessage[33m;[39m
     [90m 91 |[39m                        
 [36mreturn[39m { success[33m:[39m 
[36mfalse[39m[33m,[39m email[33m:[39m 
user[33m.[39memail[33m,[39m 
error[33m:[39m errorMessage }[33m;[39m
     [90m 92 |[39m                     
}[0m

      at app/api/campaign/send-announcement/
route.ts:89:33
          at async Promise.all (index 0)
      at POST (app/api/campaign/send-announc
ement/route.ts:62:27)
      at Object.<anonymous> (__tests__/api/s
end-announcement.test.ts:278:30)

    console.error
      [API Campaign] Some emails failed: [
        { success: false, email: 
'donor1@test.com', error: 'Network Error' },
        { success: false, email: 
'donor2@test.com', error: 'Network Error' }
      ]

    [0m [90m 184 |[39m
     [90m 185 |[39m         [36mif[39m 
(failedDetails[33m.[39mlength [33m>[39m 
[35m0[39m) {
    [31m[1m>[22m[39m[90m 186 |[39m    
         console[33m.[39merror([32m'[API 
Campaign] Some emails 
failed:'[39m[33m,[39m 
failedDetails)[33m;[39m
     [90m     |[39m                     
[31m[1m^[22m[39m
     [90m 187 |[39m         }
     [90m 188 |[39m
     [90m 189 |[39m         
[36mreturn[39m 
[33mNextResponse[39m[33m.[39mjson({[0m

      at POST (app/api/campaign/send-announc
ement/route.ts:186:21)
      at Object.<anonymous> (__tests__/api/s
end-announcement.test.ts:278:30)

    console.log
      [API Campaign] Sending 
new_campaign_invite for campaign campaign-6

      at POST (app/api/campaign/send-announc
ement/route.ts:23:17)

    console.log
      [API Campaign] Found 0 potential 
donors for invite

      at POST (app/api/campaign/send-announc
ement/route.ts:60:21)

    console.log
      [API Campaign] Sending 
new_campaign_invite for campaign 
non-existent

      at POST (app/api/campaign/send-announc
ement/route.ts:23:17)

    console.error
      [API Campaign] Error fetching 
campaign: { message: 'Not found' }

    [0m [90m 35 |[39m
     [90m 36 |[39m         [36mif[39m 
(campaignError [33m||[39m 
[33m![39mcampaign) {
    [31m[1m>[22m[39m[90m 37 |[39m     
        console[33m.[39merror([32m'[API 
Campaign] Error fetching 
campaign:'[39m[33m,[39m 
campaignError)[33m;[39m
     [90m    |[39m                     
[31m[1m^[22m[39m
     [90m 38 |[39m             
[36mreturn[39m 
[33mNextResponse[39m[33m.[39mjson({ 
error[33m:[39m [32m'Campaign not 
found'[39m }[33m,[39m { 
status[33m:[39m [35m404[39m 
})[33m;[39m
     [90m 39 |[39m         }
     [90m 40 |[39m[0m

      at POST (app/api/campaign/send-announc
ement/route.ts:37:21)
      at Object.<anonymous> (__tests__/api/s
end-announcement.test.ts:345:30)

    console.log
      [API Campaign] Sending 
new_campaign_invite for campaign test

      at POST (app/api/campaign/send-announc
ement/route.ts:23:17)

    console.error
      [API Campaign] Error fetching 
campaign: { message: 'Not found' }

    [0m [90m 35 |[39m
     [90m 36 |[39m         [36mif[39m 
(campaignError [33m||[39m 
[33m![39mcampaign) {
    [31m[1m>[22m[39m[90m 37 |[39m     
        console[33m.[39merror([32m'[API 
Campaign] Error fetching 
campaign:'[39m[33m,[39m 
campaignError)[33m;[39m
     [90m    |[39m                     
[31m[1m^[22m[39m
     [90m 38 |[39m             
[36mreturn[39m 
[33mNextResponse[39m[33m.[39mjson({ 
error[33m:[39m [32m'Campaign not 
found'[39m }[33m,[39m { 
status[33m:[39m [35m404[39m 
})[33m;[39m
     [90m 39 |[39m         }
     [90m 40 |[39m[0m

      at POST (app/api/campaign/send-announc
ement/route.ts:37:21)
      at Object.<anonymous> (__tests__/api/s
end-announcement.test.ts:365:30)

  ΓùÅ Campaign Email Auto-Send Feature ΓÇ║ 
Email Sending ΓÇ║ should send email with 
correct subject for new campaign invite

    expect(jest.fn()).toHaveBeenCalledTimes(
expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 230 |[39m
     [90m 231 |[39m             [90m// 
Verify email was sent[39m
    [31m[1m>[22m[39m[90m 232 |[39m    
         expect(mockResendInstance[33m.[39
memails[33m.[39msend)[33m.[39mtoHaveBeen
CalledTimes([35m1[39m)[33m;[39m
     [90m     |[39m                       
                             
[31m[1m^[22m[39m
     [90m 233 |[39m
     [90m 234 |[39m             [90m// 
Verify email subject[39m
     [90m 235 |[39m             
[36mconst[39m emailCall [33m=[39m mockRe
sendInstance[33m.[39memails[33m.[39msend
[33m.[39mmock[33m.[39mcalls[[35m0[39m]
[[35m0[39m][33m;[39m[0m

      at Object.<anonymous> (__tests__/api/s
end-announcement.test.ts:232:52)

  ΓùÅ Campaign Email Auto-Send Feature ΓÇ║ 
Email Sending ΓÇ║ should handle email 
sending failures gracefully

    expect(received).toBe(expected) // 
Object.is equality

    Expected: 1
    Received: 0

    [0m [90m 282 |[39m             expect
(response[33m.[39mstatus)[33m.[39mtoBe(
[35m200[39m)[33m;[39m
     [90m 283 |[39m             expect(res
ult[33m.[39msummary[33m.[39mtotal)[33m.
[39mtoBe([35m2[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 284 |[39m    
         expect(result[33m.[39msummary[33
m.[39msuccess)[33m.[39mtoBe([35m1[39m)
[33m;[39m
     [90m     |[39m                       
                     [31m[1m^[22m[39m
     [90m 285 |[39m             expect(res
ult[33m.[39msummary[33m.[39mfailed)[33m
.[39mtoBe([35m1[39m)[33m;[39m
     [90m 286 |[39m         })[33m;[39m
     [90m 287 |[39m[0m

      at Object.<anonymous> (__tests__/api/s
end-announcement.test.ts:284:44)

  ΓùÅ Campaign Email Auto-Send Feature ΓÇ║ 
Error Handling ΓÇ║ should return 500 when 
RESEND_API_KEY is missing

    expect(received).toBe(expected) // 
Object.is equality

    Expected: 500
    Received: 404

    [0m [90m 366 |[39m             
[36mconst[39m result [33m=[39m 
[36mawait[39m 
response[33m.[39mjson()[33m;[39m
     [90m 367 |[39m
    [31m[1m>[22m[39m[90m 368 |[39m    
         expect(response[33m.[39mstatus)[
33m.[39mtoBe([35m500[39m)[33m;[39m
     [90m     |[39m                       
              [31m[1m^[22m[39m
     [90m 369 |[39m             expect(res
ult[33m.[39merror)[33m.[39mtoContain([3
2m'RESEND_API_KEY'[39m)[33m;[39m
     [90m 370 |[39m         })[33m;[39m
     [90m 371 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (__tests__/api/s
end-announcement.test.ts:368:37)

Test Suites: 4 failed, 12 passed, 16 total
Tests:       8 failed, 2 skipped, 147 
passed, 157 total
Snapshots:   0 total
Time:        10.841 s
Ran all test suites.
